% Created 2022-07-08 Fri 11:44
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{textcomp}
\usepackage{color}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{changes}
\usepackage{pdflscape}
\usepackage{geometry}
\usepackage[normalem]{ulem}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{dsfont}
\usepackage{array}
\usepackage{ifthen}
\usepackage{hyperref}
\usepackage{natbib}
\author{Brice Ozenne}
\date{\today}
\title{Partial correlation in linear models}
\hypersetup{
 colorlinks=true,
 pdfauthor={Brice Ozenne},
 pdftitle={Partial correlation in linear models},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 26.3 (Org mode 9.4.6)},
 pdflang={English}
 }
\begin{document}

\maketitle
\tableofcontents

For illustration we will use the following packages:
\lstset{language=r,label= ,caption= ,captionpos=b,numbers=none}
\begin{lstlisting}
library(LMMstar)
library(mvtnorm)
library(nlme)
library(ggplot2)
\end{lstlisting}

and dataset \citep{bland1995calculating}:
\lstset{language=r,label= ,caption= ,captionpos=b,numbers=none}
\begin{lstlisting}
data("bland1995", package = "rmcorr")
bland1995$Subject <- as.factor(bland1995$Subject)
head(bland1995)
\end{lstlisting}

\begin{verbatim}
  Subject   pH PacO2
1       1 6.68  3.97
2       1 6.53  4.12
3       1 6.43  4.09
4       1 6.33  3.97
5       2 6.85  5.27
6       2 7.06  5.37
\end{verbatim}


The aim is to relate intramural pH and PaCO2 using eight subjects:

\begin{verbatim}
`geom_smooth()` using formula 'y ~ x'
\end{verbatim}


\begin{center}
\includegraphics[trim={0 0 0 0},width=1\textwidth]{./figures/gg-describe-dataset.pdf}
\end{center}


\section{Partial partial in multiple linear regression}
\label{sec:org0b9f317}

To 
\lstset{language=r,label= ,caption= ,captionpos=b,numbers=none}
\begin{lstlisting}
data("Orthodont", package = "nlme")
head(Orthodont)
\end{lstlisting}

\begin{verbatim}
Grouped Data: distance ~ age | Subject
  distance age Subject  Sex
1     26.0   8     M01 Male
2     25.0  10     M01 Male
3     29.0  12     M01 Male
4     31.0  14     M01 Male
5     21.5   8     M02 Male
6     22.5  10     M02 Male
\end{verbatim}




\#\#\#\# 1) F statistic as Wald statistic \#\#\#\#
\#\# F = statistic\textsuperscript{2}/1

\#\# anova(e.lm2)
\#\#      F-statistic df.num df.denom    p.value    
\#\# Sex      27.218      1   105.02 9.1954e-07 \textbf{*}
\#\# age      45.606      1   105.02 8.2475e-10 \textbf{*}
\#\# summary(e.lm2, print = FALSE)\$mean\$statistic\textsuperscript{2} \#\# (remove intercept)
\#\# [1] 27.21829  45.60563

\#\#\#\# 2) F statistic as Residuals Sum of Squares \#\#\#\#
\#\# ANOVA: SS(total) = SSR + SSE                     (after centering of Y)
\#\#         YY       = YMY + Y(1-H)Y                 where H = X (XX)\textsuperscript{-1} X
\#\#                  = \(\beta\) (XX) \(\beta\) + Y (1-H) Y  where beta = (XX)\textsuperscript{-1} XY
\#\#                  = \(\sigma\)\textsuperscript{2} (\(\beta\)\textsuperscript{2}/sigma\textsuperscript{2}\textsubscript{\(\beta\)} + n-p)  where beta = (XX)\textsuperscript{-1} XY
\#\#        MSSR      = SSR/1 = \(\sigma\)\textsuperscript{2} * \(\beta\)\textsuperscript{2}/sigma\textsuperscript{2}\textsubscript{\(\beta\)}
\#\#        MSSE      = SSE/(n-p) = \(\sigma\)\textsuperscript{2} 
\#\# F = MSSR / MSSE
\#\#   = \(\beta\)\textsuperscript{2}/\(\sigma\)\textsuperscript{2}\textsubscript{\(\beta\)} = statistic\textsuperscript{2}

\#\# as.double(sigma(e.lm2)) * coef(e.lm2)[-1]\textsuperscript{2} /(diag(vcov(e.lm2))[-1])
\#\# SexFemale       age 
\#\#  140.4649  235.3560 
\#\# as.double(sigma(e.lm2))
\#\# 5.160679

\#\# anova(lm(distance \textasciitilde{} Sex+age, data = Orthodont))
\#\#            Df Sum Sq Mean Sq F value    Pr(>F)    
\#\# age         1 235.36 235.356  45.606 8.253e-10 \textbf{*}
\#\# Residuals 105 541.87   5.161

\#\#\#\# 3) R2 as Residuals Sum of Squares \#\#\#\# 
\#\# R2 = SSR / (SSR + SSE)
\#\#    = 1 / (1 + SSE/SSR)
\#\#    = 1 / (1 + n-p/(beta\textsuperscript{2}/sigma\textsuperscript{2}\textsubscript{beta}))
\#\#    = statistic\textsuperscript{2} / (statistic\textsuperscript{2} + n-p)

\#\# sqrt((summary(e.lm2, print = FALSE)\$mean\$statistic\textsuperscript{2}/(summary(e.lm2, print = FALSE)\$mean\$statistic\textsuperscript{2}+summary(e.lm2, print = FALSE)\$mean\$df))[-1])
\#\# [1] 0.2058261 0.3027727
\#\# sqrt(235.36 / (235.36+541.87))
\#\# partialCor(distance+age \textasciitilde{} Sex, data = Orthodont)
\#\#                       estimate     se   df lower upper  p.value
\#\# rho(distance,age)     0.55 0.0971 73.6 0.401 0.671 1.45e-08

\section{Partial partial with repeated measurements}
\label{sec:org840b150}

\section{Reference}
\label{sec:orgfcb61c5}
\begingroup
\renewcommand{\section}[2]{}
\bibliographystyle{apalike}
\bibliography{bibliography} 
\endgroup

\appendix \titleformat{\section}
{\normalfont\Large\bfseries}{}{1em}{Appendix~\thesection:~}

\renewcommand{\thefigure}{\Alph{figure}}
\renewcommand{\thetable}{\Alph{table}}
\renewcommand{\theequation}{\Alph{equation}}

\setcounter{figure}{0}    
\setcounter{table}{0}    
\setcounter{equation}{0}    
\end{document}