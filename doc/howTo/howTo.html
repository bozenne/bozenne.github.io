<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-10-29 ma 10:14 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>"How to" in \Rlogo</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Brice Ozenne" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">"How to" in \Rlogo</h1>
<p>
This document present ways to perform basic operations in \Rlogo:
</p>
<ul class="org-ul">
<li>importing data</li>
<li>data management</li>
<li>graphical displaying</li>
<li>modeling</li>
<li>loops and parallel computing</li>
<li>generating data through simulation</li>
</ul>

<p>
\clearpage
</p>

<p>
\tableofcontents
</p>

<p>
\clearpage
</p>

<div id="outline-container-org5ead18c" class="outline-2">
<h2 id="org5ead18c"><span class="section-number-2">1</span> Packages</h2>
<div class="outline-text-2" id="text-1">
<p>
The following packages are necessary to run the code suggested in the document:
</p>
<div class="org-src-container">
<pre class="src src-R">## importing data and data management
library(data.table)

## graphical display
library(ggplot2)

## modeling
library(car)

library(prodlim) # survival analysis
library(survival) # survival analysis

## statistical inference
library(multcomp) # adjust for multiple comparisons

## loops and parallel computing
library(pbapply)
library(doSNOW)
library(parallel)

## simulation
library(lava)
</pre>
</div>

<p>
\clearpage
</p>
</div>
</div>

<div id="outline-container-orgf8fa0b5" class="outline-2">
<h2 id="orgf8fa0b5"><span class="section-number-2">2</span> Import/export data</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-org85e0d65" class="outline-3">
<h3 id="org85e0d65"><span class="section-number-3">2.1</span> Set the working directory</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The working directory is where \Rlogo \(\;\) will, by default, look for files
to import and export data or pictures. The current working directory
can be accessed using:
</p>
<div class="org-src-container">
<pre class="src src-R">getwd()
</pre>
</div>

<pre class="example">
[1] "c:/Users/hpl802/AppData/Roaming/R"
</pre>

<p>
It can be changed using the function <code>setwd()</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">path &lt;- "c:/Users/hpl802/Documents/Teaching/repeated measurements 2017/Doc/howTo/"
setwd(path)
</pre>
</div>

<p>
We can check that the working directory has indeed changed calling
again <code>getwd()</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">getwd()
</pre>
</div>

<pre class="example">
[1] "c:/Users/hpl802/Documents/Teaching/repeated measurements 2017/Doc/howTo"
</pre>
</div>
</div>

<div id="outline-container-orga94221a" class="outline-3">
<h3 id="orga94221a"><span class="section-number-3">2.2</span> See which files are present in the current directory</h3>
<div class="outline-text-3" id="text-2-2">
<p>
List all files in the current directory:
</p>
<div class="org-src-container">
<pre class="src src-R">list.files()
</pre>
</div>

<pre class="example">
 [1] "#howTo.org#"       "figures"           "howTo.org"         "howTo.org.~1~"    
 [5] "howTo.org.~2~"     "howTo.org.~3~"     "howTo.org.~4~"     "howTo.org.~5~"    
 [9] "howTo.org.~6~"     "howTo.org.~7~"     "howTo.org_archive" "howTo.pdf"        
[13] "howTo.soc"         "howTo.tex"         "howTo.tex.~1~"     "howTo.tex.~100~"  
[17] "howTo.tex.~101~"   "howTo.tex.~102~"   "howTo.tex.~103~"   "howTo.tex.~104~"  
[21] "howTo.tex.~105~"   "howTo.tex.~106~"   "howTo.tex.~2~"     "howTo.tex.~3~"    
[25] "howTo.tex.~4~"     "howTo.tex.~5~"     "howTo.tex.~6~"     "howTo.tex.~98~"   
[29] "howTo.tex.~99~"    "mydata.csv"        "mydata.txt"        "myplot.png"
</pre>

<p>
There are many files. To list files in the current directory with a
given extension, e.g. <code>.txt</code> use:
</p>
<div class="org-src-container">
<pre class="src src-R">list.files(pattern = ".txt")
</pre>
</div>

<pre class="example">
[1] "mydata.txt"
</pre>

<p>
There is only one file with a <code>.txt</code> extension, it is called
<code>mydata.txt</code>.
</p>
</div>
</div>

<div id="outline-container-org1892c12" class="outline-3">
<h3 id="org1892c12"><span class="section-number-3">2.3</span> Check that the file we want to import exists:</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Test whether the file exists:
</p>
<div class="org-src-container">
<pre class="src src-R">file.exists("./mydata.txt")
</pre>
</div>

<pre class="example">
[1] TRUE
</pre>
</div>
</div>

<div id="outline-container-org4d93321" class="outline-3">
<h3 id="org4d93321"><span class="section-number-3">2.4</span> Display a file before importing it</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Display the first three lines of the file we want to import
</p>
<div class="org-src-container">
<pre class="src src-R">readLines("./mydata.txt")[1:3]
</pre>
</div>

<pre class="example">
[1] "Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3"
[2] "1 40 Male Yes 50 57 56 50.67 55.88 61.69"                                     
[3] "2 38 Female No 52 57 63 50.26 55.73 60.37"
</pre>

<div class="org-src-container">
<pre class="src src-R">readLines("./mydata.csv")[1:3]
</pre>
</div>

<pre class="example">
[1] "Id;Age;Gender;Treatment;weight_t1;weight_t2;weight_t3;size_t1;size_t2;size_t3"
[2] "1;40;Male;Yes;50;57;56;50,67;55,88;61,69"                                     
[3] "2;38;Female;No;52;57;63;50,26;55,73;60,37"
</pre>
</div>
</div>

<div id="outline-container-orgbe650a8" class="outline-3">
<h3 id="orgbe650a8"><span class="section-number-3">2.5</span> Import a data from a file (.txt, .csv)</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Import a file and store the dataset into a <code>data.frame</code> object:
</p>
<div class="org-src-container">
<pre class="src src-R">dfW.data &lt;- read.table("./mydata.txt", header = TRUE, na.strings = ".")
</pre>
</div>

<p>
Import a file and store the dataset into a <code>data.table</code> object:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data &lt;- fread("./mydata.txt", header = TRUE, na.strings = ".")
</pre>
</div>

<p>
In both cases, the argument <code>na.strings</code> specifies which character(s)
in the dataset stands for missing values. The argument <code>header=TRUE</code>
indicates that the first line of the dataset contains the name of the
columns of the dataset (and not the data of an observation). See
<code>?read.table</code> or <code>?fread</code> for further explanations about the arguments
of these functions.
</p>

<p>
\bigskip
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><span class="underline">Note:</span></td>
<td class="org-left"><code>"./"</code></td>
<td class="org-left">stands for current directory, e.g. <code>"./mydata.txt"</code> abreviated in <code>"mydata.txt"</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>"../"</code></td>
<td class="org-left">stands for parent directory, e.g. <code>"../mydata.txt"</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>"/"</code></td>
<td class="org-left">stands for root directory, e.g. <code>"/mydata.txt"</code></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org7f503a8" class="outline-3">
<h3 id="org7f503a8"><span class="section-number-3">2.6</span> Import data from a specific format (e.g. excel files or outputs from SPSS/SAS)</h3>
<div class="outline-text-3" id="text-2-6">
<p>
There are many packages that can be used to read excel files, e.g.:
</p>
<ul class="org-ul">
<li><b>xlsx</b> package: function <code>read.xlsx</code>.</li>
<li><b>gdata</b> package: function <code>read.xls</code>.</li>
</ul>

<p>
\bigskip
</p>

<p>
The <b>foreign</b> package enable to read a variety for files, e.g.:
</p>
<ul class="org-ul">
<li><code>read.spss</code>: read an spss data file.</li>
<li><code>read.ssd</code>: obtain a data frame from a sas permanent dataset, via read.xport.</li>
</ul>

<p>
\bigskip
</p>

<p>
To load .rds files use <code>readRDS</code> and to load .rdata files use <code>load</code>.
</p>
</div>
</div>

<div id="outline-container-org7d96c92" class="outline-3">
<h3 id="org7d96c92"><span class="section-number-3">2.7</span> Export data</h3>
<div class="outline-text-3" id="text-2-7">
<p>
To export a data.frame to a file one can use:
</p>
<ul class="org-ul">
<li><code>write.csv</code> to export a .csv file</li>
<li><code>write.table</code> to export a .txt file</li>
<li><code>xlsx::write.xlsx</code> to export a .xlsx file</li>
<li><code>data.table::fwrite</code></li>
</ul>
<div class="org-src-container">
<pre class="src src-R">fwrite(dtW.data, file = "./mydata.csv", sep = ";", dec = ",")
fwrite(dtW.data, file = "./mydata.txt", sep = " ", dec = ".")
</pre>
</div>

<p>
To export a single R object (can be anything) use <code>saveRDS</code>.
To export several R object use <code>save</code>.
To export the current workspace use <code>save.image</code>.
</p>
</div>
</div>

<div id="outline-container-orgfbab260" class="outline-3">
<h3 id="orgfbab260"><span class="section-number-3">2.8</span> Export table</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">
<pre class="src src-R">library(Publish)
myTable1 &lt;- univariateTable(Treatment ~ Age + Gender + weight_t1, data = dtW.data)
</pre>
</div>

<p>
Export to word:
</p>
<div class="org-src-container">
<pre class="src src-R">library(officer)
myTable1.doc &lt;- body_add_table(x = read_docx(), 
							   value =  summary(myTable1)) 
print(myTable1.doc, target = "./Table1.docx")
</pre>
</div>

<pre class="example">
[1] "c:/Users/hpl802/Documents/Teaching/repeated measurements 2017/Doc/howTo/Table1.docx"
</pre>
</div>
</div>

<div id="outline-container-org39b7b35" class="outline-3">
<h3 id="org39b7b35"><span class="section-number-3">2.9</span> Export graphs</h3>
<div class="outline-text-3" id="text-2-9">
<p>
The functions <code>pdf</code>, <code>png</code>, <code>postscript</code>, <code>svg</code>, <code>tiff</code> enables a graph to
export to .pdf, .png, .eps, .svg, or .tiff file:
</p>
<div class="org-src-container">
<pre class="src src-R">png("myplot.png")
plot(1:10)
dev.off()
</pre>
</div>

<pre class="example">
null device 
          1
</pre>

<div class="org-src-container">
<pre class="src src-R">file.exists("myplot.png")
</pre>
</div>

<pre class="example">
[1] TRUE
</pre>

<p>
For exporting graph generated by <b>ggplot2</b>, use <code>ggsave</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb63a2cd" class="outline-2">
<h2 id="orgb63a2cd"><span class="section-number-2">3</span> Data management</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-org87569af" class="outline-3">
<h3 id="org87569af"><span class="section-number-3">3.1</span> Categorize age into groups</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-R">vec &lt;- dfW.data$weight_t3
vec
</pre>
</div>

<pre class="example">
 [1] 56 63 62 60 64 65 66 63 59 64 59 58 63 64 61 64 67 54 57 65 63 60 60 57 66 65 60 53 57 58 58
[32] 58 59 63 64 58 64 58 59 59 60 59 57 62 61 63 63 63 65 55 59 65 71 64 62 62 64 58 61 61 65 64
[63] 66 60 58 60 63 57 58 68 59 60 54 61 60 63 61 60 62 61 59 59 65 62 66 58 64 66 62 65 59 63 57
[94] 62 64 59 63 57 62 59 55 68
</pre>

<div class="org-src-container">
<pre class="src src-R">cut(vec, breaks = seq(0,100,5))
</pre>
</div>

<pre class="example">
  [1] (55,60] (60,65] (60,65] (55,60] (60,65] (60,65] (65,70] (60,65] (55,60] (60,65] (55,60]
 [12] (55,60] (60,65] (60,65] (60,65] (60,65] (65,70] (50,55] (55,60] (60,65] (60,65] (55,60]
 [23] (55,60] (55,60] (65,70] (60,65] (55,60] (50,55] (55,60] (55,60] (55,60] (55,60] (55,60]
 [34] (60,65] (60,65] (55,60] (60,65] (55,60] (55,60] (55,60] (55,60] (55,60] (55,60] (60,65]
 [45] (60,65] (60,65] (60,65] (60,65] (60,65] (50,55] (55,60] (60,65] (70,75] (60,65] (60,65]
 [56] (60,65] (60,65] (55,60] (60,65] (60,65] (60,65] (60,65] (65,70] (55,60] (55,60] (55,60]
 [67] (60,65] (55,60] (55,60] (65,70] (55,60] (55,60] (50,55] (60,65] (55,60] (60,65] (60,65]
 [78] (55,60] (60,65] (60,65] (55,60] (55,60] (60,65] (60,65] (65,70] (55,60] (60,65] (65,70]
 [89] (60,65] (60,65] (55,60] (60,65] (55,60] (60,65] (60,65] (55,60] (60,65] (55,60] (60,65]
[100] (55,60] (50,55] (65,70]
20 Levels: (0,5] (5,10] (10,15] (15,20] (20,25] (25,30] (30,35] (35,40] (40,45] (45,50] ... (95,100]
</pre>
</div>
</div>
</div>

<div id="outline-container-org1469561" class="outline-2">
<h2 id="org1469561"><span class="section-number-2">4</span> Data management using the <i>data.table</i> package</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-orgd59e291" class="outline-3">
<h3 id="orgd59e291"><span class="section-number-3">4.1</span> Introduction</h3>
<div class="outline-text-3" id="text-4-1">
<p>
In \Rlogo, data are usually stored in <code>data.frame</code> object since compared
to matrices, it enables to store in a same object different types of
variables (e.g. numeric, categorical, &#x2026;). Data management can be
performed using the core R function, e.g. using <code>for</code> loops or
the <code>apply</code>, <code>tapply</code>, <code>lapply</code> functions.  However this approach will
most often requires many lines of code to get the expected
transformation.  A faster and safer approach is to functions/packages
suited to the structure of longitudinal data.
</p>

<p>
\bigskip
</p>

<p>
We present here how to use the <i>data.table</i> package to perform the
most common operations in data management. The main benefit of using
this package are:
</p>
<ul class="org-ul">
<li>a concise and consistant syntax for performing the most common
operations in data management.</li>
<li>fast and memory efficient implementation (i.e. able to deal with
dataset with millions of lines).</li>
<li>share common features with the SQL terminology.</li>
</ul>
<p>
A concise summary of the features can be found at:
<a href="https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf">https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf</a>
</p>

<p>
\bigskip
</p>

<p>
Additional documentation can be found:
</p>
<ul class="org-ul">
<li>in the documentation of the function <code>data.table</code>: type <code>?data.table</code> in \Rlogo.</li>
<li>on the webpage of the package: <a href="https://github.com/Rdatatable/data.table/wiki">https://github.com/Rdatatable/data.table/wiki</a>.</li>
<li>in the vignettes of the package: <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a>.</li>
</ul>

<p>
\bigskip
</p>

<p>
<span class="underline">Note</span>: the <b>wide format</b> denote a format where each line corresponds
to a different individuals. Repeated measurements of the same quantity
(e.g. weight) for a given individual are stored in different columns
(e.g. <code>weight_t1</code>, <code>weight_t2</code>).
</p>

<div class="org-src-container">
<pre class="src src-R">head(dtW.data)
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  1  40   Male       Yes        50        57        56   50.67   55.88   61.69
2:  2  38 Female        No        52        57        63   50.26   55.73   60.37
3:  3  41   Male        No        47        54        62   46.61   50.89   56.52
4:  4  41 Female       Yes        48        55        60   45.95   53.10   59.82
5:  5  42 Female       Yes        52        56        64   52.86   58.41   63.79
6:  6  38   Male       Yes        52        59        65   49.37   57.91   64.45
</pre>

<p>
 The <b>long</b> format denote a format where the same individual may
appear on different lines but a given quantity is only stored in one
column. In case of repeated measurement, an additional column encodes
at which repetition the measurement was obtained (e.g. <code>time</code>):
</p>
<div class="org-src-container">
<pre class="src src-R">head(dtL.data)
</pre>
</div>

<pre class="example">
   Id Gender Treatment Age time weight  size
1:  1   Male       Yes  40    1     50 50.67
2:  2 Female        No  38    1     52 50.26
3:  3   Male        No  41    1     47 46.61
4:  4 Female       Yes  41    1     48 45.95
5:  5 Female       Yes  42    1     52 52.86
6:  6   Male       Yes  38    1     52 49.37
</pre>
</div>
</div>

<div id="outline-container-org9f84e75" class="outline-3">
<h3 id="org9f84e75"><span class="section-number-3">4.2</span> Display a dataset</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Using the <code>print</code> method:
</p>
<div class="org-src-container">
<pre class="src src-R">print(dtW.data) # equivalent to just dtW.data
</pre>
</div>
<pre class="example">
      Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
  1:   1  40   Male       Yes        50        57        56   50.67   55.88   61.69
  2:   2  38 Female        No        52        57        63   50.26   55.73   60.37
  3:   3  41   Male        No        47        54        62   46.61   50.89   56.52
  4:   4  41 Female       Yes        48        55        60   45.95   53.10   59.82
  5:   5  42 Female       Yes        52        56        64   52.86   58.41   63.79
 ---                                                                               
 98:  98  39   Male        No        53        59        57   49.51   53.80   61.13
 99:  99  42 Female       Yes        51        57        62   47.60   56.55   59.47
100: 100  40 Female        No        53        55        59   50.06   54.90   61.89
101: 101  38 Female        No        48        58        55   49.51   54.01   62.32
102: 102  39 Female        No        52        58        68   47.35   56.08   59.49
</pre>

<p>
To print more lines use the argument <code>topn</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">print(dtW.data, topn = 6)
</pre>
</div>

<pre class="example">
      Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
  1:   1  40   Male       Yes        50        57        56   50.67   55.88   61.69
  2:   2  38 Female        No        52        57        63   50.26   55.73   60.37
  3:   3  41   Male        No        47        54        62   46.61   50.89   56.52
  4:   4  41 Female       Yes        48        55        60   45.95   53.10   59.82
  5:   5  42 Female       Yes        52        56        64   52.86   58.41   63.79
  6:   6  38   Male       Yes        52        59        65   49.37   57.91   64.45
 ---                                                                               
 97:  97  39   Male        No        50        60        63   51.72   57.86   61.06
 98:  98  39   Male        No        53        59        57   49.51   53.80   61.13
 99:  99  42 Female       Yes        51        57        62   47.60   56.55   59.47
100: 100  40 Female        No        53        55        59   50.06   54.90   61.89
101: 101  38 Female        No        48        58        55   49.51   54.01   62.32
102: 102  39 Female        No        52        58        68   47.35   56.08   59.49
</pre>
</div>
</div>

<div id="outline-container-orgf9474af" class="outline-3">
<h3 id="orgf9474af"><span class="section-number-3">4.3</span> Extract row(s), i.e. all the variables relative to one or several observations</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-orgafd6039" class="outline-4">
<h4 id="orgafd6039"><span class="section-number-4">4.3.1</span> Extract row(s) using row numbers</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
Extract the third line:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[3]
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  3  41   Male        No        47        54        62   46.61   50.89   56.52
</pre>

<p>
Extract line one to four:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[1:4]
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  1  40   Male       Yes        50        57        56   50.67   55.88   61.69
2:  2  38 Female        No        52        57        63   50.26   55.73   60.37
3:  3  41   Male        No        47        54        62   46.61   50.89   56.52
4:  4  41 Female       Yes        48        55        60   45.95   53.10   59.82
</pre>

<p>
Extract line one, three, and five:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[c(1,3,5)]
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  1  40   Male       Yes        50        57        56   50.67   55.88   61.69
2:  3  41   Male        No        47        54        62   46.61   50.89   56.52
3:  5  42 Female       Yes        52        56        64   52.86   58.41   63.79
</pre>
</div>
</div>

<div id="outline-container-org1401892" class="outline-4">
<h4 id="org1401892"><span class="section-number-4">4.3.2</span> Extract row(s) according to conditions</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
Extract lines corresponding to the observations with <code>Id</code> equals to <code>1</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[Id == 1]
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  1  40   Male       Yes        50        57        56   50.67   55.88   61.69
</pre>

<p>
Extract lines corresponding to the males:
</p>
<div class="org-src-container">
<pre class="src src-R">newdata &lt;- dtW.data[Gender == "Male"]
head(newdata)
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  1  40   Male       Yes        50        57        56   50.67   55.88   61.69
2:  3  41   Male        No        47        54        62   46.61   50.89   56.52
3:  6  38   Male       Yes        52        59        65   49.37   57.91   64.45
4:  9  42   Male       Yes        46        52        59   49.53   52.84   60.54
5: 11  42   Male        No        55        58        59   50.03   55.09   60.94
6: 12  41   Male       Yes        50        52        58   48.66   52.73   55.86
</pre>

<p>
Extract lines corresponding to the males whose age is inferior or
equal to 38:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[Gender == "Male" &amp; Age &lt;= 38]
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  6  38   Male       Yes        52        59        65   49.37   57.91   64.45
2: 41  37   Male        No        53        55        60   47.59   53.75   57.00
3: 76  38   Male        No        53        57        63   48.10   54.82   55.29
4: 91  38   Male        No        51        55        59   52.05   57.01   59.53
</pre>

<p>
Extract lines corresponding to observations where <code>Age</code> is inferior or
equal to 37, or greater or equal to 43 :
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[Age &lt;= 37 | Age &gt;= 43]
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1: 10  43 Female       Yes        52        57        64   53.22   57.25   62.94
2: 41  37   Male        No        53        55        60   47.59   53.75   57.00
3: 45  43 Female       Yes        48        51        61   49.88   54.41   56.18
4: 73  43   Male       Yes        46        53        54   48.44   52.74   60.93
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3e8539" class="outline-3">
<h3 id="orgf3e8539"><span class="section-number-3">4.4</span> Extract column(s), i.e. all the observations relative to one or several variables</h3>
<div class="outline-text-3" id="text-4-4">
</div><div id="outline-container-org9e72325" class="outline-4">
<h4 id="org9e72325"><span class="section-number-4">4.4.1</span> Extract column(s) using column numbers</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Extract the third column:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, 3, with = FALSE]
</pre>
</div>

<pre class="example">
     Gender
  1:   Male
  2: Female
  3:   Male
  4: Female
  5: Female
 ---       
 98:   Male
 99: Female
100: Female
101: Female
102: Female
</pre>

<p>
Alternatively:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[[3]]
</pre>
</div>

<pre class="example">
  [1] "Male"   "Female" "Male"   "Female" "Female" "Male"   "Female" "Female" "Male"   "Female"
 [11] "Male"   "Male"   "Female" "Female" "Female" "Female" "Female" "Female" "Male"   "Female"
 [21] "Male"   "Male"   "Female" "Male"   "Female" "Male"   "Male"   "Male"   "Female" "Female"
 [31] "Male"   "Male"   "Male"   "Male"   "Female" "Female" "Female" "Female" "Male"   "Male"  
 [41] "Male"   "Female" "Female" "Female" "Female" "Female" "Female" "Female" "Male"   "Male"  
 [51] "Female" "Male"   "Male"   "Male"   "Female" "Female" "Male"   "Male"   "Female" "Male"  
 [61] "Female" "Male"   "Male"   "Male"   "Female" "Male"   "Female" "Male"   "Male"   "Male"  
 [71] "Female" "Female" "Male"   "Female" "Female" "Male"   "Female" "Female" "Female" "Female"
 [81] "Male"   "Male"   "Female" "Female" "Male"   "Female" "Female" "Female" "Female" "Female"
 [91] "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Male"   "Female" "Female"
[101] "Female" "Female"
</pre>

<p>
Extract column one, three, and five:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, c(1,3,5), with = FALSE]
</pre>
</div>

<pre class="example">
      Id Gender weight_t1
  1:   1   Male        50
  2:   2 Female        52
  3:   3   Male        47
  4:   4 Female        48
  5:   5 Female        52
 ---                     
 98:  98   Male        53
 99:  99 Female        51
100: 100 Female        53
101: 101 Female        48
102: 102 Female        52
</pre>
</div>
</div>

<div id="outline-container-orgae5e0c3" class="outline-4">
<h4 id="orgae5e0c3"><span class="section-number-4">4.4.2</span> Extract column(s) using column names</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
Extract one column, e.g. <code>Id</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, Id] # similar to dtW.data[,"Id",with=FALSE]
</pre>
</div>

<pre class="example">
 [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23
[24]  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46
[47]  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69
[70]  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90  91  92
[93]  93  94  95  96  97  98  99 100 101 102
</pre>

<p>
Extract several columns, e.g. <code>Id</code> and <code>Age</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, .(Id,Age)] 
# similar to dtW.data[, c("Id","Age"), with = FALSE]
# similar to dtW.data[, .SD, .SDcols = c("Id","Age")]
</pre>
</div>

<pre class="example">
      Id Age
  1:   1  40
  2:   2  38
  3:   3  41
  4:   4  41
  5:   5  42
 ---        
 98:  98  39
 99:  99  42
100: 100  40
101: 101  38
102: 102  39
</pre>
</div>
</div>
</div>
<div id="outline-container-org0b02c68" class="outline-3">
<h3 id="org0b02c68"><span class="section-number-3">4.5</span> Work with categorical variables</h3>
<div class="outline-text-3" id="text-4-5">
</div><div id="outline-container-orgd85272c" class="outline-4">
<h4 id="orgd85272c"><span class="section-number-4">4.5.1</span> Convert a numeric/character into a factor</h4>
<div class="outline-text-4" id="text-4-5-1">
<div class="org-src-container">
<pre class="src src-R">class(dtW.data[,Gender])
</pre>
</div>

<pre class="example">
[1] "character"
</pre>

<div class="org-src-container">
<pre class="src src-R">dtW.data[, Gender := as.factor(Gender)]
class(dtW.data[,Gender])
</pre>
</div>

<pre class="example">
[1] "factor"
</pre>

<div class="org-src-container">
<pre class="src src-R">class(dtW.data[,Id])
</pre>
</div>

<pre class="example">
[1] "integer"
</pre>

<div class="org-src-container">
<pre class="src src-R">dtW.data[, Id := as.factor(Id)]
class(dtW.data[,Id])
</pre>
</div>

<pre class="example">
[1] "factor"
</pre>
</div>
</div>

<div id="outline-container-org4643f28" class="outline-4">
<h4 id="org4643f28"><span class="section-number-4">4.5.2</span> Divide a continuous variable into categories</h4>
<div class="outline-text-4" id="text-4-5-2">
<div class="org-src-container">
<pre class="src src-R">dtW.data[, AgeCategory := cut(Age, breaks = c(0,38,40,42,100))]
dtW.data[,.(Age,AgeCategory)]
</pre>
</div>

<pre class="example">
     Age AgeCategory
  1:  40     (38,40]
  2:  38      (0,38]
  3:  41     (40,42]
  4:  41     (40,42]
  5:  42     (40,42]
 ---                
 98:  39     (38,40]
 99:  42     (40,42]
100:  40     (38,40]
101:  38      (0,38]
102:  39     (38,40]
</pre>

<p>
Alternatively:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, AgeCategory0 := findInterval(Age, vec = c(0,38,40,42,100))]
dtW.data[,.(Age,AgeCategory0)]
</pre>
</div>

<pre class="example">
     Age AgeCategory0
  1:  40            3
  2:  38            2
  3:  41            3
  4:  41            3
  5:  42            4
 ---                 
 98:  39            2
 99:  42            4
100:  40            3
101:  38            2
102:  39            2
</pre>

<p>
The arguments <code>rightmost</code> and <code>left.open</code> can be used to decide what
to do with the values equaling the breaks (i.e. one of the value of
the argument <code>vec</code>). But it is often easier to modify <code>vec</code> such that no value
equals the breaks, e.g. using <code>c(0,38,40,42,100)-1e12</code>.
</p>
</div>
</div>

<div id="outline-container-org4bb31c3" class="outline-4">
<h4 id="org4bb31c3"><span class="section-number-4">4.5.3</span> Redefine the levels of a factor variable</h4>
<div class="outline-text-4" id="text-4-5-3">
<div class="org-src-container">
<pre class="src src-R">dtW.data[,AgeCategory0 := factor(AgeCategory0, 
								levels = 1:4, 
								labels = c("[0-37)","[38-39)","[40-41)","[42-100)"))]
dtW.data[,.(Age,AgeCategory0,AgeCategory)]
</pre>
</div>

<pre class="example">
     Age AgeCategory0 AgeCategory
  1:  40      [40-41)     (38,40]
  2:  38      [38-39)      (0,38]
  3:  41      [40-41)     (40,42]
  4:  41      [40-41)     (40,42]
  5:  42     [42-100)     (40,42]
 ---                             
 98:  39      [38-39)     (38,40]
 99:  42     [42-100)     (40,42]
100:  40      [40-41)     (38,40]
101:  38      [38-39)      (0,38]
102:  39      [38-39)     (38,40]
</pre>
</div>
</div>
</div>

<div id="outline-container-org193bb02" class="outline-3">
<h3 id="org193bb02"><span class="section-number-3">4.6</span> Extract simple features of a dataset</h3>
<div class="outline-text-3" id="text-4-6">
</div><div id="outline-container-orgfb40bae" class="outline-4">
<h4 id="orgfb40bae"><span class="section-number-4">4.6.1</span> Number of rows and columns</h4>
<div class="outline-text-4" id="text-4-6-1">
<div class="org-src-container">
<pre class="src src-R">dim(dtW.data)
</pre>
</div>

<pre class="example">
[1] 102  12
</pre>

<p>
The dataset has 102 rows and 7 columns.
</p>
</div>
</div>

<div id="outline-container-org34af169" class="outline-4">
<h4 id="org34af169"><span class="section-number-4">4.6.2</span> Name of the columns</h4>
<div class="outline-text-4" id="text-4-6-2">
<div class="org-src-container">
<pre class="src src-R">names(dtW.data)
</pre>
</div>

<pre class="example">
[1] "Id"           "Age"          "Gender"       "Treatment"    "weight_t1"    "weight_t2"   
[7] "weight_t3"    "size_t1"      "size_t2"      "size_t3"      "AgeCategory"  "AgeCategory0"
</pre>
</div>
</div>

<div id="outline-container-orga2646be" class="outline-4">
<h4 id="orga2646be"><span class="section-number-4">4.6.3</span> Type of the columns</h4>
<div class="outline-text-4" id="text-4-6-3">
<div class="org-src-container">
<pre class="src src-R">str(dtW.data)
</pre>
</div>

<pre class="example">
Classes 'data.table' and 'data.frame':	102 obs. of  12 variables:
 $ Id          : Factor w/ 102 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ Age         : int  40 38 41 41 42 38 42 40 42 43 ...
 $ Gender      : Factor w/ 2 levels "Female","Male": 2 1 2 1 1 2 1 1 2 1 ...
 $ Treatment   : chr  "Yes" "No" "No" "Yes" ...
 $ weight_t1   : int  50 52 47 48 52 52 52 51 46 52 ...
 $ weight_t2   : int  57 57 54 55 56 59 63 52 52 57 ...
 $ weight_t3   : int  56 63 62 60 64 65 66 63 59 64 ...
 $ size_t1     : num  50.7 50.3 46.6 46 52.9 ...
 $ size_t2     : num  55.9 55.7 50.9 53.1 58.4 ...
 $ size_t3     : num  61.7 60.4 56.5 59.8 63.8 ...
 $ AgeCategory : Factor w/ 4 levels "(0,38]","(38,40]",..: 2 1 3 3 3 1 3 2 3 4 ...
 $ AgeCategory0: Factor w/ 4 levels "[0-37)","[38-39)",..: 3 2 3 3 4 2 4 3 4 4 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 - attr(*, "index")= int
</pre>

<p>
The column <code>Gender</code> contains a factor variable with two levels <code>"Yes"</code>
and <code>"No"</code>. 
</p>

<p>
The column <code>Id</code> contains integers while the columns <code>weight_t3</code>
contains numeric numbers.
</p>
</div>
</div>

<div id="outline-container-org09d6746" class="outline-4">
<h4 id="org09d6746"><span class="section-number-4">4.6.4</span> Summary statistics by column</h4>
<div class="outline-text-4" id="text-4-6-4">
<div class="org-src-container">
<pre class="src src-R">summary(dtW.data)
</pre>
</div>

<pre class="example">
      Id          Age           Gender    Treatment           weight_t1       weight_t2    
1      : 1   Min.   :37.00   Female:54   Length:102         Min.   :46.00   Min.   :51.00  
2      : 1   1st Qu.:39.00   Male  :48   Class :character   1st Qu.:49.25   1st Qu.:55.00  
3      : 1   Median :40.00               Mode  :character   Median :51.00   Median :57.00  
4      : 1   Mean   :40.26                                  Mean   :50.87   Mean   :56.29  
5      : 1   3rd Qu.:41.00                                  3rd Qu.:52.00   3rd Qu.:58.00  
6      : 1   Max.   :43.00                                  Max.   :57.00   Max.   :63.00  
(Other):96                                                                                 
  weight_t3       size_t1         size_t2         size_t3        AgeCategory   AgeCategory0
Min.   :53.0   Min.   :45.67   Min.   :50.89   Min.   :55.02   (0,38]  : 9   [0-37)  : 1   
1st Qu.:59.0   1st Qu.:48.45   1st Qu.:54.17   1st Qu.:59.35   (38,40] :48   [38-39) :29   
Median :61.0   Median :50.44   Median :55.59   Median :61.00   (40,42] :42   [40-41) :53   
Mean   :61.2   Mean   :50.55   Mean   :55.54   Mean   :60.98   (42,100]: 3   [42-100):19   
3rd Qu.:64.0   3rd Qu.:52.01   3rd Qu.:57.03   3rd Qu.:62.66                               
Max.   :71.0   Max.   :59.15   Max.   :61.45   Max.   :67.06
</pre>

<p>
The column <code>Gender</code> contains 48 <code>Male</code> and 54 <code>Female</code>. The median
value of <code>Age</code> is 40.
</p>
</div>
</div>

<div id="outline-container-org0726eeb" class="outline-4">
<h4 id="org0726eeb"><span class="section-number-4">4.6.5</span> Number of missing values</h4>
<div class="outline-text-4" id="text-4-6-5">
<p>
Total number
</p>
<div class="org-src-container">
<pre class="src src-R">sum(is.na(dtW.data))
</pre>
</div>

<pre class="example">
[1] 0
</pre>

<p>
Number of missing values by variable:
</p>
<div class="org-src-container">
<pre class="src src-R">colSums(is.na(dtW.data))
</pre>
</div>

<pre class="example">
     Id          Age       Gender    Treatment    weight_t1    weight_t2    weight_t3 
      0            0            0            0            0            0            0 
size_t1      size_t2      size_t3  AgeCategory AgeCategory0 
      0            0            0            0            0
</pre>

<p>
Number of missing values by observation:
</p>
<div class="org-src-container">
<pre class="src src-R">rowSums(is.na(dtW.data))
</pre>
</div>

<pre class="example">
 [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[48] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[95] 0 0 0 0 0 0 0 0
</pre>
</div>
</div>

<div id="outline-container-orgabfbe6f" class="outline-4">
<h4 id="orgabfbe6f"><span class="section-number-4">4.6.6</span> Mean value of a column</h4>
<div class="outline-text-4" id="text-4-6-6">
<p>
First extract the values from a column:
</p>
<div class="org-src-container">
<pre class="src src-R">vec.tempo &lt;- dtW.data[,Age]
</pre>
</div>

<p>
Then compute the mean:
</p>
<div class="org-src-container">
<pre class="src src-R">mean(vec.tempo)
</pre>
</div>
<pre class="example">
[1] 40.26471
</pre>

<p>
Alternatively:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[,mean(Age)]
</pre>
</div>

<pre class="example">
[1] 40.26471
</pre>
</div>
</div>

<div id="outline-container-org157784f" class="outline-4">
<h4 id="org157784f"><span class="section-number-4">4.6.7</span> Correlation between values of several columns</h4>
<div class="outline-text-4" id="text-4-6-7">
<p>
First extract the columns:
</p>
<div class="org-src-container">
<pre class="src src-R">dt.tempo &lt;- dtW.data[,.(weight_t1,weight_t2,weight_t3)]
</pre>
</div>

<p>
Then compute the correlation:
</p>
<div class="org-src-container">
<pre class="src src-R">cor(dt.tempo)
</pre>
</div>
<pre class="example">
          weight_t1 weight_t2 weight_t3
weight_t1 1.0000000 0.1882809 0.3179175
weight_t2 0.1882809 1.0000000 0.2374259
weight_t3 0.3179175 0.2374259 1.0000000
</pre>

<p>
Alternatively:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[,cor(cbind(weight_t1,weight_t2,weight_t3))]
</pre>
</div>

<pre class="example">
          weight_t1 weight_t2 weight_t3
weight_t1 1.0000000 0.1882809 0.3179175
weight_t2 0.1882809 1.0000000 0.2374259
weight_t3 0.3179175 0.2374259 1.0000000
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ca4882" class="outline-3">
<h3 id="org1ca4882"><span class="section-number-3">4.7</span> Performing operations on a group of rows</h3>
<div class="outline-text-3" id="text-4-7">
</div><div id="outline-container-org01b35b6" class="outline-4">
<h4 id="org01b35b6"><span class="section-number-4">4.7.1</span> Computing the number of observations per subgroup</h4>
<div class="outline-text-4" id="text-4-7-1">
<p>
Compute the number of observation per gender:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, .N, by = "Gender"]
</pre>
</div>

<pre class="example">
   Gender  N
1:   Male 48
2: Female 54
</pre>

<p>
Alternatively:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, NROW(.SD), by = "Gender"]
</pre>
</div>

<pre class="example">
   Gender V1
1:   Male 48
2: Female 54
</pre>
</div>
</div>

<div id="outline-container-org5ac0926" class="outline-4">
<h4 id="org5ac0926"><span class="section-number-4">4.7.2</span> Computing the mean by subgroup</h4>
<div class="outline-text-4" id="text-4-7-2">
<p>
Compute the mean weight at time 1 by gender:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, mean(weight_t1), by = "Gender"]
</pre>
</div>

<pre class="example">
   Gender       V1
1:   Male 50.45833
2: Female 51.24074
</pre>

<p>
Alternative display:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, .(mean = mean(weight_t1)), by = "Gender"]
</pre>
</div>

<pre class="example">
   Gender     mean
1:   Male 50.45833
2: Female 51.24074
</pre>

<p>
Compute the mean weight at time 1 to 3 by gender:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, .(mean_t1 = mean(weight_t1),
			 mean_t2 = mean(weight_t2),
			 mean_t3 = mean(weight_t3)), 
		 by = "Gender"]
</pre>
</div>

<pre class="example">
   Gender  mean_t1  mean_t2  mean_t3
1:   Male 50.45833 55.81250 60.64583
2: Female 51.24074 56.72222 61.68519
</pre>

<p>
Compute the mean weight at time 1 to 3 by gender and treatment group:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data[, .(mean_t1 = mean(weight_t1),
			 mean_t2 = mean(weight_t2),
			 mean_t3 = mean(weight_t3)), 
		 by = c("Gender","Treatment")]
</pre>
</div>

<pre class="example">
   Gender Treatment  mean_t1  mean_t2  mean_t3
1:   Male       Yes 50.42857 55.09524 60.23810
2: Female        No 51.65517 56.93103 61.75862
3:   Male        No 50.48148 56.37037 60.96296
4: Female       Yes 50.76000 56.48000 61.60000
</pre>
</div>
</div>

<div id="outline-container-orgd601f2c" class="outline-4">
<h4 id="orgd601f2c"><span class="section-number-4">4.7.3</span> Computing the correlation matrix by subgroup</h4>
<div class="outline-text-4" id="text-4-7-3">
<p>
We create a matrix containing the variables of interest, compute the
correlation matrix and print it.
</p>
<div class="org-src-container">
<pre class="src src-R">null.result &lt;- dtW.data[, print(cor(cbind(weight_t1,weight_t2,weight_t3))), 
						by = "Gender"]
</pre>
</div>

<pre class="example">
          weight_t1 weight_t2 weight_t3
weight_t1 1.0000000 0.2867753 0.2886667
weight_t2 0.2867753 1.0000000 0.2740567
weight_t3 0.2886667 0.2740567 1.0000000
           weight_t1  weight_t2 weight_t3
weight_t1 1.00000000 0.03214955 0.3148578
weight_t2 0.03214955 1.00000000 0.1551156
weight_t3 0.31485784 0.15511561 1.0000000
</pre>

<p>
If we want to store the correlation matrix we need to wrap it into
<code>.()</code> to keep the matrix format:
</p>
<div class="org-src-container">
<pre class="src src-R">result &lt;- dtW.data[, .(cor = .(cor(cbind(weight_t1,weight_t2,weight_t3)))), 
				   by = "Gender"]
result[,cor]
</pre>
</div>

<pre class="example">
[[1]]
          weight_t1 weight_t2 weight_t3
weight_t1 1.0000000 0.2867753 0.2886667
weight_t2 0.2867753 1.0000000 0.2740567
weight_t3 0.2886667 0.2740567 1.0000000

[[2]]
           weight_t1  weight_t2 weight_t3
weight_t1 1.00000000 0.03214955 0.3148578
weight_t2 0.03214955 1.00000000 0.1551156
weight_t3 0.31485784 0.15511561 1.0000000
</pre>

<p>
Alternatively:
</p>
<div class="org-src-container">
<pre class="src src-R">null.result &lt;- dtW.data[, print(cor(.SD)), 
						.SDcols = c("weight_t1","weight_t2","weight_t3"), 
						by = "Gender"]
</pre>
</div>

<pre class="example">
          weight_t1 weight_t2 weight_t3
weight_t1 1.0000000 0.2867753 0.2886667
weight_t2 0.2867753 1.0000000 0.2740567
weight_t3 0.2886667 0.2740567 1.0000000
           weight_t1  weight_t2 weight_t3
weight_t1 1.00000000 0.03214955 0.3148578
weight_t2 0.03214955 1.00000000 0.1551156
weight_t3 0.31485784 0.15511561 1.0000000
</pre>

<pre class="example">
[[1]]
          weight_t1 weight_t2 weight_t3
weight_t1 1.0000000 0.2867753 0.2886667
weight_t2 0.2867753 1.0000000 0.2740567
weight_t3 0.2886667 0.2740567 1.0000000

[[2]]
           weight_t1  weight_t2 weight_t3
weight_t1 1.00000000 0.03214955 0.3148578
weight_t2 0.03214955 1.00000000 0.1551156
weight_t3 0.31485784 0.15511561 1.0000000
</pre>
</div>
</div>
</div>

<div id="outline-container-org4eb5513" class="outline-3">
<h3 id="org4eb5513"><span class="section-number-3">4.8</span> Sort a dataset according to one or several variables</h3>
<div class="outline-text-3" id="text-4-8">
<p>
Sort the dataset according to <code>Age</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">setkeyv(dtW.data, c("Age"))
dtW.data
</pre>
</div>

<pre class="example">
     Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3 AgeCategory
  1: 41  37   Male        No        53        55        60   47.59   53.75   57.00      (0,38]
  2:  2  38 Female        No        52        57        63   50.26   55.73   60.37      (0,38]
  3:  6  38   Male       Yes        52        59        65   49.37   57.91   64.45      (0,38]
  4: 46  38 Female        No        53        57        63   49.27   61.45   66.59      (0,38]
  5: 48  38 Female        No        52        57        63   54.27   57.71   65.63      (0,38]
 ---                                                                                          
 98: 95  42   Male       Yes        51        55        64   51.05   56.48   60.30     (40,42]
 99: 99  42 Female       Yes        51        57        62   47.60   56.55   59.47     (40,42]
100: 10  43 Female       Yes        52        57        64   53.22   57.25   62.94    (42,100]
101: 45  43 Female       Yes        48        51        61   49.88   54.41   56.18    (42,100]
102: 73  43   Male       Yes        46        53        54   48.44   52.74   60.93    (42,100]
     AgeCategory0
  1:       [0-37)
  2:      [38-39)
  3:      [38-39)
  4:      [38-39)
  5:      [38-39)
 ---             
 98:     [42-100)
 99:     [42-100)
100:     [42-100)
101:     [42-100)
102:     [42-100)
</pre>

<p>
Sort the dataset according to <code>Age</code> and then <code>weight_t1</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">setkeyv(dtW.data, cols = c("Age","weight_t1"))
dtW.data
</pre>
</div>

<pre class="example">
      Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3 AgeCategory
  1:  41  37   Male        No        53        55        60   47.59   53.75   57.00      (0,38]
  2: 101  38 Female        No        48        58        55   49.51   54.01   62.32      (0,38]
  3:  59  38 Female       Yes        49        60        61   51.08   53.77   60.75      (0,38]
  4:  91  38   Male        No        51        55        59   52.05   57.01   59.53      (0,38]
  5:   2  38 Female        No        52        57        63   50.26   55.73   60.37      (0,38]
 ---                                                                                           
 98:  11  42   Male        No        55        58        59   50.03   55.09   60.94     (40,42]
 99:  54  42   Male       Yes        57        60        64   58.75   57.57   63.98     (40,42]
100:  73  43   Male       Yes        46        53        54   48.44   52.74   60.93    (42,100]
101:  45  43 Female       Yes        48        51        61   49.88   54.41   56.18    (42,100]
102:  10  43 Female       Yes        52        57        64   53.22   57.25   62.94    (42,100]
     AgeCategory0
  1:       [0-37)
  2:      [38-39)
  3:      [38-39)
  4:      [38-39)
  5:      [38-39)
 ---             
 98:     [42-100)
 99:     [42-100)
100:     [42-100)
101:     [42-100)
102:     [42-100)
</pre>
</div>
</div>

<div id="outline-container-orgc5c165c" class="outline-3">
<h3 id="orgc5c165c"><span class="section-number-3">4.9</span> Change the names of the column in a dataset</h3>
<div class="outline-text-3" id="text-4-9">
<p>
Use a small dataset
</p>
<div class="org-src-container">
<pre class="src src-R">dt.simple &lt;- dtW.data[,.(Age,Gender,Id,Treatment)]
head(dt.simple)
</pre>
</div>

<pre class="example">
   Age Gender  Id Treatment
1:  37   Male  41        No
2:  38 Female 101        No
3:  38 Female  59       Yes
4:  38   Male  91        No
5:  38 Female   2        No
6:  38   Male   6       Yes
</pre>

<p>
Change all names:
</p>
<div class="org-src-container">
<pre class="src src-R">setnames(dt.simple, c("AgeXX","GenderYY","IdZZ","Treat"))
head(dt.simple)
</pre>
</div>

<pre class="example">
   AgeXX GenderYY IdZZ Treat
1:    37     Male   41    No
2:    38   Female  101    No
3:    38   Female   59   Yes
4:    38     Male   91    No
5:    38   Female    2    No
6:    38     Male    6   Yes
</pre>

<p>
Change one or several names (less memory efficient):
</p>
<div class="org-src-container">
<pre class="src src-R">names(dt.simple)[1:2] &lt;- c("Age","Gender")
head(dt.simple)
</pre>
</div>

<pre class="example">
   Age Gender IdZZ Treat
1:  37   Male   41    No
2:  38 Female  101    No
3:  38 Female   59   Yes
4:  38   Male   91    No
5:  38 Female    2    No
6:  38   Male    6   Yes
</pre>
</div>
</div>

<div id="outline-container-orgf4f15a6" class="outline-3">
<h3 id="orgf4f15a6"><span class="section-number-3">4.10</span> Converting a dataset from the wide format to the long format</h3>
<div class="outline-text-3" id="text-4-10">
</div><div id="outline-container-org18b36b0" class="outline-4">
<h4 id="org18b36b0"><span class="section-number-4">4.10.1</span> Univariate melt</h4>
<div class="outline-text-4" id="text-4-10-1">
<p>
Data in the wide format:
</p>
<div class="org-src-container">
<pre class="src src-R">head(dtW.data)
</pre>
</div>

<pre class="example">
    Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3 AgeCategory
1:  41  37   Male        No        53        55        60   47.59   53.75   57.00      (0,38]
2: 101  38 Female        No        48        58        55   49.51   54.01   62.32      (0,38]
3:  59  38 Female       Yes        49        60        61   51.08   53.77   60.75      (0,38]
4:  91  38   Male        No        51        55        59   52.05   57.01   59.53      (0,38]
5:   2  38 Female        No        52        57        63   50.26   55.73   60.37      (0,38]
6:   6  38   Male       Yes        52        59        65   49.37   57.91   64.45      (0,38]
   AgeCategory0
1:       [0-37)
2:      [38-39)
3:      [38-39)
4:      [38-39)
5:      [38-39)
6:      [38-39)
</pre>

<p>
The convertion can be done naming explicitely the columns or using <code>patterns</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">dtL.data &lt;- melt(dtW.data, id.vars = c("Id","Gender","Treatment","Age"), 
				 measure=c("weight_t1","weight_t2","weight_t3"), 
				 variable.name = "time", value.name = "weight")

dtL.data.bis &lt;- melt(dtW.data, id.vars = c("Id","Gender","Treatment","Age"), 
					 measure=patterns("weight_t"), 
					 variable.name = "time", value.name = "weight")

identical(dtL.data, dtL.data.bis)
</pre>
</div>


<pre class="example">
[1] TRUE
</pre>

<p>
Arguments (see <code>?melt.data.table</code> for more details):
</p>
<ul class="org-ul">
<li><code>id.vars</code>: name of the column(s) that are kept constant over the repetitions</li>
<li><code>measure.vars</code>: name of the columns to be melted in a single one
(i.e. repeated measurements).</li>
</ul>

<p>
\bigskip
</p>

<p>
Data in the long format:
</p>
<div class="org-src-container">
<pre class="src src-R">head(dtL.data)
</pre>
</div>

<pre class="example">
    Id Gender Treatment Age      time weight
1:  41   Male        No  37 weight_t1     53
2: 101 Female        No  38 weight_t1     48
3:  59 Female       Yes  38 weight_t1     49
4:  91   Male        No  38 weight_t1     51
5:   2 Female        No  38 weight_t1     52
6:   6   Male       Yes  38 weight_t1     52
</pre>

<p>
Reorder the data by Id and time:
</p>
<div class="org-src-container">
<pre class="src src-R">setkeyv(dtL.data, c("Id","time"))
head(dtL.data)
</pre>
</div>

<pre class="example">
   Id Gender Treatment Age      time weight
1:  1   Male       Yes  40 weight_t1     50
2:  1   Male       Yes  40 weight_t2     57
3:  1   Male       Yes  40 weight_t3     56
4:  2 Female        No  38 weight_t1     52
5:  2 Female        No  38 weight_t2     57
6:  2 Female        No  38 weight_t3     63
</pre>

<p>
\clearpage
</p>
</div>
</div>

<div id="outline-container-org0edb86c" class="outline-4">
<h4 id="org0edb86c"><span class="section-number-4">4.10.2</span> Multivariate melt</h4>
<div class="outline-text-4" id="text-4-10-2">
<p>
Use a list of vectors each containing a vector with the columns to be
melted:
</p>
<div class="org-src-container">
<pre class="src src-R">dtL.data &lt;- melt(dtW.data, id.vars = c("Id","Gender","Treatment","Age"), 
				 measure=list(c("weight_t1","weight_t2","weight_t3"), 
							  c("size_t1","size_t2","size_t3")),
				 variable.name = "time", value.name = c("weight","size"))

dtL.data.bis &lt;- melt(dtW.data, id.vars = c("Id","Gender","Treatment","Age"), 
					 measure=patterns("weight_t","size_t"),
					 variable.name = "time", value.name = c("weight","size"))

identical(dtL.data,dtL.data.bis)
</pre>
</div>

<pre class="example">
[1] TRUE
</pre>

<div class="org-src-container">
<pre class="src src-R">dtL.data
</pre>
</div>

<pre class="example">
      Id Gender Treatment Age time weight  size
  1:  41   Male        No  37    1     53 47.59
  2: 101 Female        No  38    1     48 49.51
  3:  59 Female       Yes  38    1     49 51.08
  4:  91   Male        No  38    1     51 52.05
  5:   2 Female        No  38    1     52 50.26
 ---                                           
302:  11   Male        No  42    3     59 60.94
303:  54   Male       Yes  42    3     64 63.98
304:  73   Male       Yes  43    3     54 60.93
305:  45 Female       Yes  43    3     61 56.18
306:  10 Female       Yes  43    3     64 62.94
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdde1a9e" class="outline-3">
<h3 id="orgdde1a9e"><span class="section-number-3">4.11</span> Converting a dataset from the long format to the wide format</h3>
<div class="outline-text-3" id="text-4-11">
</div><div id="outline-container-org17e9c81" class="outline-4">
<h4 id="org17e9c81"><span class="section-number-4">4.11.1</span> Univariate</h4>
<div class="outline-text-4" id="text-4-11-1">
<p>
Data in the long format:
</p>
<div class="org-src-container">
<pre class="src src-R">head(dtL.data)
</pre>
</div>

<pre class="example">
    Id Gender Treatment Age time weight  size
1:  41   Male        No  37    1     53 47.59
2: 101 Female        No  38    1     48 49.51
3:  59 Female       Yes  38    1     49 51.08
4:  91   Male        No  38    1     51 52.05
5:   2 Female        No  38    1     52 50.26
6:   6   Male       Yes  38    1     52 49.37
</pre>

<p>
The convertion can be done using a formula:
</p>
<ul class="org-ul">
<li>left side: variables that do not vary</li>
<li>right side: variable indexing the repetition whose values will be
used to name the new columns.</li>
</ul>
<div class="org-src-container">
<pre class="src src-R">dtW.data &lt;- dcast(dtL.data, value.var = c("weight"),
				  formula = Id + Gender + Treatment + Age ~ time)
</pre>
</div>

<p>
Data in the wide format:
</p>
<div class="org-src-container">
<pre class="src src-R">setnames(dtW.data, old = c("1","2","3"), new = paste0("weight_t",1:3))
dtW.data
</pre>
</div>

<pre class="example">
      Id Gender Treatment Age weight_t1 weight_t2 weight_t3
  1:   1   Male       Yes  40        50        57        56
  2:   2 Female        No  38        52        57        63
  3:   3   Male        No  41        47        54        62
  4:   4 Female       Yes  41        48        55        60
  5:   5 Female       Yes  42        52        56        64
 ---                                                       
 98:  98   Male        No  39        53        59        57
 99:  99 Female       Yes  42        51        57        62
100: 100 Female        No  40        53        55        59
101: 101 Female        No  38        48        58        55
102: 102 Female        No  39        52        58        68
</pre>

<p>
\clearpage
</p>
</div>
</div>

<div id="outline-container-org76cd8aa" class="outline-4">
<h4 id="org76cd8aa"><span class="section-number-4">4.11.2</span> Multivariate</h4>
<div class="outline-text-4" id="text-4-11-2">
<p>
Same as before but with several elements in the argument
<code>value.var</code>. Note that the repetition index (here <code>time</code>) must be the
same for both variables:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data &lt;- dcast(dtL.data, value.var = c("weight","size"),
				  formula = Id + Gender + Treatment + Age ~ time)
</pre>
</div>

<p>
Data in the wide format:
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data
</pre>
</div>

<pre class="example">
      Id Gender Treatment Age weight_1 weight_2 weight_3 size_1 size_2 size_3
  1:   1   Male       Yes  40       50       57       56  50.67  55.88  61.69
  2:   2 Female        No  38       52       57       63  50.26  55.73  60.37
  3:   3   Male        No  41       47       54       62  46.61  50.89  56.52
  4:   4 Female       Yes  41       48       55       60  45.95  53.10  59.82
  5:   5 Female       Yes  42       52       56       64  52.86  58.41  63.79
 ---                                                                         
 98:  98   Male        No  39       53       59       57  49.51  53.80  61.13
 99:  99 Female       Yes  42       51       57       62  47.60  56.55  59.47
100: 100 Female        No  40       53       55       59  50.06  54.90  61.89
101: 101 Female        No  38       48       58       55  49.51  54.01  62.32
102: 102 Female        No  39       52       58       68  47.35  56.08  59.49
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org74390ac" class="outline-2">
<h2 id="org74390ac"><span class="section-number-2">5</span> Graphical display</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-org6eb1e64" class="outline-3">
<h3 id="org6eb1e64"><span class="section-number-3">5.1</span> Descriptive plots</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-R">head(dtL.data)
</pre>
</div>

<pre class="example">
    Id Gender Treatment Age time weight  size
1:  41   Male        No  37    1     53 47.59
2: 101 Female        No  38    1     48 49.51
3:  59 Female       Yes  38    1     49 51.08
4:  91   Male        No  38    1     51 52.05
5:   2 Female        No  38    1     52 50.26
6:   6   Male       Yes  38    1     52 49.37
</pre>
</div>

<div id="outline-container-org81c3bcf" class="outline-4">
<h4 id="org81c3bcf"><span class="section-number-4">5.1.1</span> Spaguetti plot</h4>
<div class="outline-text-4" id="text-5-1-1">
</div><ol class="org-ol"><li><a id="org405b508"></a>color by individual (first ten individuals)<br /><div class="outline-text-5" id="text-5-1-1-1">
<div class="org-src-container">
<pre class="src src-R">gg.spaguetti1 &lt;- ggplot(dtL.data[Id %in% 1:10], 
						aes(x = time, y = weight, color = Id, group = Id))
gg.spaguetti1 &lt;- gg.spaguetti1 + geom_line() + geom_point()
gg.spaguetti1
</pre>
</div>

<p>
<a href="./figures/fig-spaguetti1.pdf">./figures/fig-spaguetti1.pdf</a>
</p>

<p>
\clearpage
</p>
</div></li>

<li><a id="org84f6e20"></a>color by treatment group (first ten individuals)<br /><div class="outline-text-5" id="text-5-1-1-2">
<div class="org-src-container">
<pre class="src src-R">gg.spaguetti2 &lt;- ggplot(dtL.data[Id %in% 1:10],
						aes(x = time, y = weight, color = Treatment, group = Id))
gg.spaguetti2 &lt;- gg.spaguetti2 + geom_line() + geom_point()
gg.spaguetti2
</pre>
</div>

<p>
<a href="./figures/fig-spaguetti2.pdf">./figures/fig-spaguetti2.pdf</a>
</p>

<p>
\clearpage 
</p>
</div></li>

<li><a id="orgbe6ec4d"></a>pannel for each treatment group (first ten individuals)<br /><div class="outline-text-5" id="text-5-1-1-3">
<div class="org-src-container">
<pre class="src src-R">gg.spaguetti3 &lt;- ggplot(dtL.data[Id %in% 1:10], 
						aes(x = time, y = weight, color = Id, group = Id))
gg.spaguetti3 &lt;- gg.spaguetti3 + geom_line() + geom_point()
gg.spaguetti3 &lt;- gg.spaguetti3 + facet_wrap(~ Treatment, labeller = label_both) 
gg.spaguetti3
</pre>
</div>

<p>
<a href="./figures/fig-spaguetti3.pdf">./figures/fig-spaguetti3.pdf</a>
</p>

<p>
\clearpage
</p>
</div></li>

<li><a id="org0575989"></a>individual spaguetti plot (first ten individuals)<br /><div class="outline-text-5" id="text-5-1-1-4">
<div class="org-src-container">
<pre class="src src-R">gg.spaguetti4 &lt;- ggplot(dtL.data[Id %in% 1:10], 
						aes(x = time, y = weight, color = Id, group = Id))
gg.spaguetti4 &lt;- gg.spaguetti4 + geom_line() + geom_point()
gg.spaguetti4 &lt;- gg.spaguetti4 + facet_wrap(~ Id, labeller = label_both) 
gg.spaguetti4
</pre>
</div>

<p>
<a href="./figures/fig-spaguetti4.pdf">./figures/fig-spaguetti4.pdf</a>
</p>

<p>
\clearpage
</p>
</div></li></ol>
</div>

<div id="outline-container-org4c416fb" class="outline-4">
<h4 id="org4c416fb"><span class="section-number-4">5.1.2</span> Display the mean over time</h4>
<div class="outline-text-4" id="text-5-1-2">
<div class="org-src-container">
<pre class="src src-R">gg.mean &lt;- ggplot(dtL.data[Id %in% 1:10], aes(x = time, y = weight))
gg.mean &lt;- gg.mean + stat_summary(aes(group = Treatment, color = Treatment), 
								  geom = "line", fun.y = mean, size = 2)
gg.mean &lt;- gg.mean + stat_summary(aes(group = Treatment, color = Treatment), 
								  geom = "point", fun.y = mean, size = 3)
</pre>
</div>

<p>
<a href="./figures/fig-meanTime.pdf">./figures/fig-meanTime.pdf</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgc3c6255" class="outline-3">
<h3 id="orgc3c6255"><span class="section-number-3">5.2</span> Diagnostic plots</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Consider the linear model:
</p>
<div class="org-src-container">
<pre class="src src-R">e.lm &lt;- lm(weight ~ Age + Treatment + size,
			data = dtL.data)
</pre>
</div>
</div>

<div id="outline-container-org07451a9" class="outline-4">
<h4 id="org07451a9"><span class="section-number-4">5.2.1</span> Histogram of the residuals</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
Extract the residuals:
</p>
<div class="org-src-container">
<pre class="src src-R">epsilon &lt;- residuals(e.lm, type = "response")
</pre>
</div>

<p>
Display the histogram
</p>
<p>
<a href="./figures/fig-hist-residuals.pdf">./figures/fig-hist-residuals.pdf</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org58571fe" class="outline-3">
<h3 id="org58571fe"><span class="section-number-3">5.3</span> Customize graphic</h3>
<div class="outline-text-3" id="text-5-3">
</div><div id="outline-container-orge9d7156" class="outline-4">
<h4 id="orge9d7156"><span class="section-number-4">5.3.1</span> Modify the legend of a discrete scale</h4>
<div class="outline-text-4" id="text-5-3-1">
<div class="org-src-container">
<pre class="src src-R">gg.mean2 &lt;- gg.mean + scale_colour_manual(name = "Group",
										  labels = c("X","Y"),
										  values = c("No" = "purple", 
													 "Yes" = "black"))
</pre>
</div>

<p>
<a href="./figures/fig-meanTime2.pdf">./figures/fig-meanTime2.pdf</a>
</p>
</div>
</div>

<div id="outline-container-org430ed3c" class="outline-4">
<h4 id="org430ed3c"><span class="section-number-4">5.3.2</span> Increase the font size</h4>
<div class="outline-text-4" id="text-5-3-2">
<p>
All text:
</p>
<div class="org-src-container">
<pre class="src src-R">gg.mean3 &lt;- gg.mean + theme(text = element_text(size=10))
</pre>
</div>

<p>
<a href="./figures/fig-meanTime3.pdf">./figures/fig-meanTime3.pdf</a>
</p>

<p>
Only x axis labels:
</p>
<div class="org-src-container">
<pre class="src src-R">gg.mean3 &lt;- gg.mean + theme(axis.text = element_text(size=10))
</pre>
</div>

<p>
Only axis title:
</p>
<div class="org-src-container">
<pre class="src src-R">gg.mean3 &lt;- gg.mean + theme(axis.title = element_text(size=10))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6665465" class="outline-4">
<h4 id="org6665465"><span class="section-number-4">5.3.3</span> Put the legend at the bottom</h4>
<div class="outline-text-4" id="text-5-3-3">
<div class="org-src-container">
<pre class="src src-R">gg.mean4 &lt;- gg.mean + theme(legend.position="bottom")
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc25a4ff" class="outline-4">
<h4 id="orgc25a4ff"><span class="section-number-4">5.3.4</span> Default ggplot color palette</h4>
<div class="outline-text-4" id="text-5-3-4">
<div class="org-src-container">
<pre class="src src-R">gg_color_hue &lt;- function(n) {
  hues = seq(15, 375, length = n + 1)
  hcl(h = hues, l = 65, c = 100)[1:n]
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc5facdb" class="outline-4">
<h4 id="orgc5facdb"><span class="section-number-4">5.3.5</span> Color blind palette</h4>
<div class="outline-text-4" id="text-5-3-5">
<div class="org-src-container">
<pre class="src src-R">ggthemes::colorblind_pal()(10)
</pre>
</div>
</div>
</div>
<div id="outline-container-org9b6f533" class="outline-4">
<h4 id="org9b6f533"><span class="section-number-4">5.3.6</span> Rotate x-axis labels</h4>
<div class="outline-text-4" id="text-5-3-6">
<div class="org-src-container">
<pre class="src src-R">theme(axis.text.x = element_text(angle = 90, hjust = 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org24e6e15" class="outline-4">
<h4 id="org24e6e15"><span class="section-number-4">5.3.7</span> Change tick mark labels</h4>
<div class="outline-text-4" id="text-5-3-7">
<div class="org-src-container">
<pre class="src src-R">gg.mean5 &lt;- gg.mean + scale_x_discrete(breaks=c("1","2","3"),
									   labels=c("Dose 1", "Dose 2", "Dose 3"))
</pre>
</div>

<p>
<a href="./figures/fig-meanTime5.pdf">./figures/fig-meanTime5.pdf</a>
</p>


<p>
\clearpage
</p>
</div>
</div>
</div>

<div id="outline-container-org97d0a3d" class="outline-3">
<h3 id="org97d0a3d"><span class="section-number-3">5.4</span> Path diagram</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Using lava:
</p>
<div class="org-src-container">
<pre class="src src-R">m &lt;- lvm(Y~E+X1+X2+M,M~E,E~X2)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">plot(m, plot.engine="rgraphviz")
</pre>
</div>

<p>
<a href="./figures/fig-pathDiagram1.pdf">./figures/fig-pathDiagram1.pdf</a>
</p>

<p>
Dynamic graph:
</p>
<div class="org-src-container">
<pre class="src src-R">plot(m, plot.engine="visnetwork")
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4c02431" class="outline-2">
<h2 id="org4c02431"><span class="section-number-2">6</span> Modeling</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-org7772eab" class="outline-3">
<h3 id="org7772eab"><span class="section-number-3">6.1</span> Testing linear hypotheses</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Consider the linear model:
</p>
<div class="org-src-container">
<pre class="src src-R">e.lm &lt;- lm(weight ~ Age + Treatment + size,
			data = dtL.data)
summary(e.lm)$coef
</pre>
</div>

<pre class="example">
                Estimate Std. Error    t value     Pr(&gt;|t|)
(Intercept)  13.11292977 5.84498969  2.2434479 2.559263e-02
Age          -0.05479836 0.13849481 -0.3956709 6.926272e-01
TreatmentYes -0.65247721 0.36126020 -1.8061143 7.189597e-02
size          0.81718969 0.03513376 23.2593869 2.743182e-69
</pre>

<p>
To test linear hypotheses we first need to define them using a contrast matrix:
</p>
<div class="org-src-container">
<pre class="src src-R">name.coef &lt;- names(coef(e.lm))
n.coef &lt;- length(name.coef)

C &lt;- matrix(0,nrow = 3, ncol = n.coef, 
			dimnames = list (c("Age","2 Treatment","All"), name.coef))
C["Age","Age"] &lt;- 1
C["2 Treatment","TreatmentYes"] &lt;- 2
C["All",-1] &lt;- 1
C
</pre>
</div>

<pre class="example">
            (Intercept) Age TreatmentYes size
Age                   0   1            0    0
2 Treatment           0   0            2    0
All                   0   1            1    1
</pre>
</div>

<div id="outline-container-orgb75c98b" class="outline-4">
<h4 id="orgb75c98b"><span class="section-number-4">6.1.1</span> Separate Wald tests of linear hypotheses</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
No adjustment for multiple comparison:
</p>
<div class="org-src-container">
<pre class="src src-R">summary(glht(e.lm, linfct = C), test = univariate())
</pre>
</div>

<pre class="example">
	 Simultaneous Tests for General Linear Hypotheses

Fit: lm(formula = weight ~ Age + Treatment + size, data = dtL.data)

Linear Hypotheses:
                 Estimate Std. Error t value Pr(&gt;|t|)  
Age == 0          -0.0548     0.1385  -0.396   0.6926  
2 Treatment == 0  -1.3050     0.7225  -1.806   0.0719 .
All == 0           0.1099     0.3513   0.313   0.7546  
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1
(Univariate p values reported)
</pre>

<p>
Adjustment using bonferroni:
</p>
<div class="org-src-container">
<pre class="src src-R">summary(glht(e.lm, linfct = C), test = adjusted("bonferroni"))
</pre>
</div>

<pre class="example">
	 Simultaneous Tests for General Linear Hypotheses

Fit: lm(formula = weight ~ Age + Treatment + size, data = dtL.data)

Linear Hypotheses:
                 Estimate Std. Error t value Pr(&gt;|t|)
Age == 0          -0.0548     0.1385  -0.396    1.000
2 Treatment == 0  -1.3050     0.7225  -1.806    0.216
All == 0           0.1099     0.3513   0.313    1.000
(Adjusted p values reported -- bonferroni method)
</pre>

<p>
Adjustment using the max statistic:
</p>
<div class="org-src-container">
<pre class="src src-R">summary(glht(e.lm, linfct = C), test = adjusted("single-step"))
</pre>
</div>

<pre class="example">
	 Simultaneous Tests for General Linear Hypotheses

Fit: lm(formula = weight ~ Age + Treatment + size, data = dtL.data)

Linear Hypotheses:
                 Estimate Std. Error t value Pr(&gt;|t|)
Age == 0          -0.0548     0.1385  -0.396    0.916
2 Treatment == 0  -1.3050     0.7225  -1.806    0.156
All == 0           0.1099     0.3513   0.313    0.948
(Adjusted p values reported -- single-step method)
</pre>

<p>
Alternative syntax (without contrast matrix):
</p>
<div class="org-src-container">
<pre class="src src-R">summary(glht(e.lm, 
			 linfct = c("Age = 0",
						"2*TreatmentYes = 0",
						"Age + TreatmentYes + size = 0")), 
		test = adjusted("single-step"))
</pre>
</div>

<pre class="example">
	 Simultaneous Tests for General Linear Hypotheses

Fit: lm(formula = weight ~ Age + Treatment + size, data = dtL.data)

Linear Hypotheses:
                               Estimate Std. Error t value Pr(&gt;|t|)
Age == 0                        -0.0548     0.1385  -0.396    0.916
2 * TreatmentYes == 0           -1.3050     0.7225  -1.806    0.157
Age + TreatmentYes + size == 0   0.1099     0.3513   0.313    0.948
(Adjusted p values reported -- single-step method)
</pre>
</div>
</div>

<div id="outline-container-orgc47c6af" class="outline-4">
<h4 id="orgc47c6af"><span class="section-number-4">6.1.2</span> Confidence intervals associated with linear hypotheses</h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
With no adjustment for multiplicity:
</p>
<div class="org-src-container">
<pre class="src src-R">confint(glht(e.lm, linfct = C), calpha = univariate_calpha())
</pre>
</div>

<pre class="example">
	 Simultaneous Confidence Intervals

Fit: lm(formula = weight ~ Age + Treatment + size, data = dtL.data)

Quantile = 1.9679
95% confidence level
 

Linear Hypotheses:
                 Estimate lwr     upr    
Age == 0         -0.0548  -0.3273  0.2177
2 Treatment == 0 -1.3050  -2.7268  0.1169
All == 0          0.1099  -0.5815  0.8013
</pre>

<p>
With adjustment for multiplicity:
</p>
<div class="org-src-container">
<pre class="src src-R">confint(glht(e.lm, linfct = C), calpha = adjusted_calpha())
</pre>
</div>

<pre class="example">
	 Simultaneous Confidence Intervals

Fit: lm(formula = weight ~ Age + Treatment + size, data = dtL.data)

Quantile = 2.3128
95% family-wise confidence level
 

Linear Hypotheses:
                 Estimate lwr     upr    
Age == 0         -0.0548  -0.3751  0.2655
2 Treatment == 0 -1.3050  -2.9760  0.3661
All == 0          0.1099  -0.7027  0.9225
</pre>
</div>
</div>

<div id="outline-container-org878cf6a" class="outline-4">
<h4 id="org878cf6a"><span class="section-number-4">6.1.3</span> Joint test of linear hypotheses</h4>
<div class="outline-text-4" id="text-6-1-3">
<p>
One can use the <code>Ftest()</code> or <code>Chisqtest()</code> to obtain a joint test:
</p>
<div class="org-src-container">
<pre class="src src-R">summary(glht(e.lm, 
			 linfct = c("Age = 0",
						"2*TreatmentYes = 0",
						"Age + TreatmentYes + size = 0")), 
		test = Ftest())
</pre>
</div>

<pre class="example">
	 General Linear Hypotheses

Linear Hypotheses:
                               Estimate
Age == 0                        -0.0548
2 * TreatmentYes == 0           -1.3050
Age + TreatmentYes + size == 0   0.1099

Global Test:
      F DF1 DF2    Pr(&gt;F)
1 181.2   3 302 3.349e-67
</pre>

<p>
The same can be obtained using the <code>linearHypothesis</code> method from the <code>car</code> package:
</p>
<div class="org-src-container">
<pre class="src src-R">linearHypothesis(e.lm, hypothesis.matrix = C, rhs = c(0,0,0))
</pre>
</div>

<pre class="example">
Linear hypothesis test

Hypothesis:
Age = 0
2 TreatmentYes = 0
Age  + TreatmentYes  + size = 0

Model 1: restricted model
Model 2: weight ~ Age + Treatment + size

  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1    305 7748.5                                  
2    302 2767.2  3    4981.3 181.21 &lt; 2.2e-16 ***
---
Signif. codes:  0 *** 0.001 ** 0.01 * 0.05 . 0.1   1
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgac9453a" class="outline-2">
<h2 id="orgac9453a"><span class="section-number-2">7</span> Loops and parallel computations</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-orgcb558c4" class="outline-3">
<h3 id="orgcb558c4"><span class="section-number-3">7.1</span> Apply with progress bar</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-R">ls.res &lt;- pbapply::pblapply(1:5, FUN = rnorm)
</pre>
</div>

<pre class="example">
   |                                                  | 0 % ~calculating     |++++++++++                                        | 20% ~00s             |++++++++++++++++++++                              | 40% ~00s             |++++++++++++++++++++++++++++++                    | 60% ~00s             |++++++++++++++++++++++++++++++++++++++++         | 80% ~00s             |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed = 00s
</pre>
</div>
</div>

<div id="outline-container-org57d6772" class="outline-3">
<h3 id="org57d6772"><span class="section-number-3">7.2</span> Parallel computation</h3>
<div class="outline-text-3" id="text-7-2">
</div><div id="outline-container-org1a50881" class="outline-4">
<h4 id="org1a50881"><span class="section-number-4">7.2.1</span> Detect the number of cores</h4>
<div class="outline-text-4" id="text-7-2-1">
<div class="org-src-container">
<pre class="src src-R">cores &lt;- parallel::detectCores()
cores
</pre>
</div>

<pre class="example">
[1] 4
</pre>
</div>
</div>

<div id="outline-container-orgde61b4b" class="outline-4">
<h4 id="orgde61b4b"><span class="section-number-4">7.2.2</span> Start a cluster</h4>
<div class="outline-text-4" id="text-7-2-2">
<div class="org-src-container">
<pre class="src src-R">cpus &lt;- 2

cl &lt;- snow::makeSOCKcluster(cpus)
doSNOW::registerDoSNOW(cl)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf89e600" class="outline-4">
<h4 id="orgf89e600"><span class="section-number-4">7.2.3</span> Get the name of each core</h4>
<div class="outline-text-4" id="text-7-2-3">
<div class="org-src-container">
<pre class="src src-R">cpus.name &lt;- unlist(parallel::clusterCall(cl = cl, function(x){
	myName &lt;- paste(Sys.info()[['nodename']], Sys.getpid(), sep='-')
	return(myName)
}))
cpus.name
</pre>
</div>

<pre class="example">
[1] "SUND31034-8096" "SUND31034-1476"
</pre>
</div>
</div>

<div id="outline-container-org5fd1bfd" class="outline-4">
<h4 id="org5fd1bfd"><span class="section-number-4">7.2.4</span> Export element to cluster</h4>
<div class="outline-text-4" id="text-7-2-4">
<div class="org-src-container">
<pre class="src src-R">parallel::clusterExport(cl, varlist = "cpus.name")

parallel::clusterCall(cl = cl, function(x){
	indexCPU &lt;- which(cpus.name == paste(Sys.info()[['nodename']], Sys.getpid(), sep='-'))
	indexCPU
})
</pre>
</div>

<pre class="example">
[[1]]
[1] 1

[[2]]
[1] 2
</pre>
</div>
</div>

<div id="outline-container-org08a2c30" class="outline-4">
<h4 id="org08a2c30"><span class="section-number-4">7.2.5</span> Show progress bar (in console)</h4>
<div class="outline-text-4" id="text-7-2-5">
<div class="org-src-container">
<pre class="src src-R">n.sim &lt;- 20

pb &lt;- txtProgressBar(max = n.sim, style=3)
opts &lt;- list(progress = function(n) setTxtProgressBar(pb, n))

ls.res &lt;- foreach::`%dopar%`(
					   foreach::foreach(i=1:n.sim, .options.snow=opts), {
						   Sys.sleep(0.1)
					   })
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3fe094" class="outline-4">
<h4 id="orgd3fe094"><span class="section-number-4">7.2.6</span> Show progress bar (external)</h4>
<div class="outline-text-4" id="text-7-2-6">
<div class="org-src-container">
<pre class="src src-R">n.sim &lt;- 20
parallel::clusterExport(cl, varlist = "n.sim")

ls.res &lt;- foreach::`%dopar%`(
					   foreach::foreach(iCpus=1:cpus), {
						   pb &lt;- tcltk::tkProgressBar(paste0("CPU ",iCpus), min = 0, max = n.sim, initial = 0)

						   for(iSim in 1:n.sim){
							   Sys.sleep(0.1)
							   tcltk::setTkProgressBar(pb = pb, value = iSim,
													   label = paste(iSim," over ",n.sim," iterations done") )
						   }

						   close(pb)
					   })
</pre>
</div>
</div>
</div>

<div id="outline-container-org968383d" class="outline-4">
<h4 id="org968383d"><span class="section-number-4">7.2.7</span> Stop a cluster</h4>
<div class="outline-text-4" id="text-7-2-7">
<div class="org-src-container">
<pre class="src src-R">parallel::stopCluster(cl)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org8715615" class="outline-2">
<h2 id="org8715615"><span class="section-number-2">8</span> Generate data using the <i>lava</i> package</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-orgff4b7ea" class="outline-3">
<h3 id="orgff4b7ea"><span class="section-number-3">8.1</span> Generate repeated measurements</h3>
<div class="outline-text-3" id="text-8-1">
<p>
Model:
Simulation:
</p>
<div class="org-src-container">
<pre class="src src-R">set.seed(10)
dfW.data &lt;- sim(m, n = 102, latent = FALSE)
</pre>
</div>
<p>
Display simulated data:
</p>
<div class="org-src-container">
<pre class="src src-R">head(dfW.data)
</pre>
</div>

<pre class="example">
  weight_t1 Gender Treatment weight_t2 weight_t3  size_t1  size_t2  size_t3      Age Id
1  49.59633   Male       Yes  56.62904  55.58780 50.66805 55.88362 61.69410 39.54546  1
2  52.35484 Female        No  56.68563  63.21026 50.26003 55.72930 60.36953 37.70748  2
3  46.53011   Male        No  54.36636  62.05018 46.61315 50.89281 56.52237 40.80342  3
4  48.48417 Female       Yes  54.79413  59.72995 45.95248 53.09941 59.82107 40.94933  4
5  52.17022 Female       Yes  55.71550  64.21010 52.86341 58.40516 63.79082 42.06512  5
6  52.18837   Male       Yes  58.86797  64.51316 49.36853 57.90530 64.45437 37.68392  6
</pre>

<p>
Modify simulated data 
</p>
<div class="org-src-container">
<pre class="src src-R">dtW.data &lt;- as.data.table(dfW.data)
dtW.data[,paste0("weight_t",1:3) := lapply(.SD,round),
		 .SDcols = paste0("weight_t",1:3)]
dtW.data[,paste0("size_t",1:3) := lapply(.SD,round, digit = 2),
		 .SDcols = paste0("size_t",1:3)]
dtW.data[,Age := round(Age)]

setcolorder(dtW.data, c("Id","Age","Gender","Treatment",
						paste0("weight_t",1:3),paste0("size_t",1:3)))
head(dtW.data)
</pre>
</div>

<pre class="example">
   Id Age Gender Treatment weight_t1 weight_t2 weight_t3 size_t1 size_t2 size_t3
1:  1  40   Male       Yes        50        57        56   50.67   55.88   61.69
2:  2  38 Female        No        52        57        63   50.26   55.73   60.37
3:  3  41   Male        No        47        54        62   46.61   50.89   56.52
4:  4  41 Female       Yes        48        55        60   45.95   53.10   59.82
5:  5  42 Female       Yes        52        56        64   52.86   58.41   63.79
6:  6  38   Male       Yes        52        59        65   49.37   57.91   64.45
</pre>

<p>
Export data:
</p>
<div class="org-src-container">
<pre class="src src-R">fwrite(dtW.data, file = "./mydata.csv", sep = ";", dec = ",")
fwrite(dtW.data, file = "./mydata.txt", sep = " ", dec = ".")
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e3e023" class="outline-3">
<h3 id="org9e3e023"><span class="section-number-3">8.2</span> Generate data with heteroschadasticity</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Model:
</p>
<div class="org-src-container">
<pre class="src src-R">mSim &lt;- lvm(y[m:v]~x)
constrain(mSim, v ~ x + a + b) &lt;- function(x){ x[,2] + x[,3] * exp(x[,1]) }
parameter(mSim, start = c(0,1)) &lt;- ~ a + b
</pre>
</div>

<p>
Simulation:
</p>
<div class="org-src-container">
<pre class="src src-R">set.seed(10)
n &lt;- 1e3
df.tempo &lt;- sim(mSim, n = n)
</pre>
</div>

<p>
Display:
</p>
<p>
<a href="./figures/fig-hetero.pdf">./figures/fig-hetero.pdf</a>
</p>
</div>
</div>

<div id="outline-container-orgc6f3d57" class="outline-3">
<h3 id="orgc6f3d57"><span class="section-number-3">8.3</span> Generate survival time under non proportional hazard (non-PH)</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Model:
</p>
<div class="org-src-container">
<pre class="src src-R">mSim &lt;- lvm()
regression(mSim) &lt;- eventtime ~ Gender + Age
regression(mSim) &lt;- s ~ exp(0.6 * Treatment - 0.5 * Gender)
distribution(mSim,~ Treatment + Gender) &lt;- binomial.lvm()
distribution(mSim,~cens) &lt;- coxWeibull.lvm(scale = 1)
distribution(mSim,~eventtime) &lt;- coxWeibull.lvm(scale = 0.3,shape =~ s)
eventTime(mSim) &lt;- time ~ min(eventtime = 1, cens = 0)
</pre>
</div>

<p>
Simulation:
</p>
<div class="org-src-container">
<pre class="src src-R">set.seed(10)
n &lt;- 1e3
df.tempo &lt;- sim(mSim, n = n)
</pre>
</div>

<p>
Display:
</p>
<p>
<a href="./figures/fig-nonPH.pdf">./figures/fig-nonPH.pdf</a>
</p>
</div>
</div>

<div id="outline-container-orgcfcc9f4" class="outline-3">
<h3 id="orgcfcc9f4"><span class="section-number-3">8.4</span> Generate survival time with delayed treatment effect</h3>
<div class="outline-text-3" id="text-8-4">
<p>
Generative model with non-PH group effect but no Age effect:
</p>
<div class="org-src-container">
<pre class="src src-R">rates1 &lt;- c(0.25,0.5,0.1); cuts &lt;- c(0,3,5)
rates2 &lt;- c(0.25,0.1,0.1); cuts &lt;- c(0,3,5)
lasttime &lt;- 20

m1 &lt;- lvm(Age[50:5]~1)
m2 &lt;- lvm(Age[50:5]~1)
distribution(m1,~eventtime) &lt;- coxExponential.lvm(rate=rates1,timecut=cuts)
distribution(m2,~eventtime) &lt;- coxExponential.lvm(rate=rates2,timecut=cuts)
transform(m1,status~eventtime) &lt;- function(x){as.numeric(x[,1]&lt;= lasttime)}
transform(m2,status~eventtime) &lt;- function(x){as.numeric(x[,1]&lt;= lasttime)}
transform(m1,time~eventtime) &lt;- function(x){pmin(lasttime,x[,1])}
transform(m2,time~eventtime) &lt;- function(x){pmin(lasttime,x[,1])}
latent(m1) &lt;- ~eventtime
latent(m2) &lt;- ~eventtime
</pre>
</div>

<p>
Simulate data:
</p>
<div class="org-src-container">
<pre class="src src-R">set.seed(12)
n &lt;- 500
d1 &lt;- as.data.table(sim(m1,n,latent=FALSE))
d2 &lt;- as.data.table(sim(m2,n,latent=FALSE))
dt.data &lt;- rbind(cbind(d1,group="treatment"),cbind(d2,group="placebo"))
dt.data
</pre>
</div>

<pre class="example">
           Age status       time     group
   1: 46.68935      1  3.8755119 treatment
   2: 53.52666      1  3.2816799 treatment
   3: 47.86065      1  0.8515517 treatment
   4: 47.94281      1 10.1313180 treatment
   5: 45.53314      1  2.6198951 treatment
  ---                                     
 996: 46.47948      1  2.1560011   placebo
 997: 52.78256      1  6.6831242   placebo
 998: 45.10627      1  6.0589065   placebo
 999: 49.24545      1 12.5248064   placebo
1000: 49.08839      1  1.9096902   placebo
</pre>

<p>
Display survival curves by group:
</p>
<p>
<a href="./figures/fig-delayedTreatmentEffect.pdf">./figures/fig-delayedTreatmentEffect.pdf</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Brice Ozenne</p>
<p class="date">Created: 2018-10-29 ma 10:14</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
